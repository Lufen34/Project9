env:
  - DOCKER_COMPOSE_VERSION=1.27.2

addons:
  apt:
    packages:
      - docker-ce

  sonarcloud:
    organization: "onune5mgafygrs6rbwhf5hwvm0kfx5s1"
    token:
      secure: "**************************" # encrypted value of your token

services:
  - docker

before_install:
  - curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
  - sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"
  - sudo apt-get update
  #- sudo apt-get -y install docker-ce docker-ce-cli containerd.io
  - docker-compose --version
  - sudo rm /usr/local/bin/docker-compose
  - curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` > docker-compose
  - chmod +x docker-compose
  - sudo mv docker-compose /usr/local/bin
  - sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose
  - cd ./docker/dev/
  - docker-compose pull
  - docker-compose build
  - docker-compose create
  - docker-compose up -d

language: java
jdk: openjdk11

install: true


cache:
  directories:
    - $HOME/.m2

notifications:
  email: lufen34@gmail.com


script:
  - mvn test
  # the following command line builds the project, runs the tests with coverage and then execute the SonarCloud analysis
  - mvn clean org.jacoco:jacoco-maven-plugin:prepare-agent install sonar:sonar -Dsonar.projectKey=Lufen34_Project9

